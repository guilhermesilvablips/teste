{
  "data": {
    "createdAt": "2024-10-07T11:19:37.208Z",
    "updatedAt": "2024-10-07T12:19:28.120Z",
    "id": "kbuuN4jwVRflRzPl",
    "name": "Agente Alfa",
    "active": false,
    "nodes": [
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "191c1aec-934c-4ba2-b396-3738b50f4d78",
                "name": "tool_calls",
                "value": "={{ $json.required_action.submit_tool_outputs.tool_calls }}",
                "type": "array"
              }
            ]
          },
          "options": {}
        },
        "id": "d80bf4c2-0801-4ecc-a4d8-6c524185473f",
        "name": "Captura Tool Calls",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -420,
          1380
        ]
      },
      {
        "parameters": {
          "fieldToSplitOut": "tool_calls",
          "options": {
            "destinationFieldName": "properties"
          }
        },
        "id": "e81cf943-29ab-4bfb-84b4-f36949879e82",
        "name": "Split Out",
        "type": "n8n-nodes-base.splitOut",
        "typeVersion": 1,
        "position": [
          -220,
          1380
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "f724eaa4-72cc-4bbd-9b1a-b279ec2c8e52",
                "name": "arguments",
                "value": "={{ $json.properties.function.arguments }}",
                "type": "object"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "id": "735cb907-a7c3-433a-a56b-402ae1821f2c",
        "name": "Separa Arguments",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          260,
          1380
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "79854708-0135-4a8b-827b-74bcd2ac8fe7",
                "name": "response",
                "value": "={{ \"success\" in $json.response.first() ? [\"Nenhum registro encontrado\"] : $json.response }}",
                "type": "array"
              }
            ]
          },
          "options": {}
        },
        "id": "e042b591-6295-4c5b-9238-49d7e3c45c14",
        "name": "Response",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          2120,
          1440
        ]
      },
      {
        "parameters": {
          "mode": "raw",
          "jsonOutput": "={\n\"tool_call_id\":\"{{ $('Separa Arguments').item.json[\"properties\"][\"id\"] }}\",\n\"output\": {{ JSON.stringify(JSON.stringify($json[\"response\"])) }}\n}",
          "options": {}
        },
        "id": "e6026c8b-b13e-486f-918a-77e55f6565e1",
        "name": "Tool Call ID",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          2340,
          1440
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6174ef56-939f-48d8-97c5-2e458eb06267",
                "name": "thread_id",
                "value": "={{ $json[$('Variáveis Globais').item.json.assistant_id] }}",
                "type": "string"
              },
              {
                "id": "37da7440-91ec-4311-80e1-4a801a1f6b65",
                "name": "phone",
                "value": "={{ $json.phone }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "99ccf447-9435-42a1-9d9a-b7a59e0e6560",
        "name": "Preparta thread_id",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -5160,
          1480
        ]
      },
      {
        "parameters": {
          "content": "# Entradas\n## **Zap** \n## **Chat**",
          "height": 890.9947994983759,
          "width": 4218.716280878499,
          "color": 7
        },
        "id": "4cca582f-581f-41b9-8052-abfa70620081",
        "name": "Sticky Note",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -11640.884312060676,
          1440
        ]
      },
      {
        "parameters": {
          "jsCode": "$vars.thread_nova = false\nreturn items"
        },
        "id": "5aa74181-504d-46e0-a8d2-968953fa289a",
        "name": "Variáveis Globais - Code",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -10540,
          1740
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "7fad812c-4f7b-41bb-a426-5aca9dc08bc3",
                "leftValue": "={{ $('Variáveis Globais').item.json.em_manutencao }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "38a2bd08-4a8f-49da-8cc1-4cef5dd5e6dc",
        "name": "Está em manutenção?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -7340,
          1740
        ]
      },
      {
        "parameters": {
          "collection": "users",
          "options": {},
          "query": "={\n  \"phone\": \"{{ $('Variáveis Globais').item.json.user_id }}\"\n}"
        },
        "id": "d13c7277-786d-4153-b703-02744789839e",
        "name": "MongoDB - Get User",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -7060,
          1960
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "iRLHzNSsYJ662KTH",
            "name": "MongoDB - Chat - Blips"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "1bbb3958-988e-479e-add8-6584965f9d3f",
                "leftValue": "={{ !!Object.keys($node[\"MongoDB - Get User\"].data).length }}",
                "rightValue": 1,
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "4ad6cab9-b834-4246-acf6-a75f949ac311",
        "name": "If - User Exists",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -6840,
          1960
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "b9c8dcb8-7a7d-4a06-8ad2-6fc05f1694bf",
                "name": "name",
                "value": "={{ $('Variáveis Globais').item.json.user_name }}",
                "type": "string"
              },
              {
                "id": "322f9814-b3ff-45f8-9210-47e5ee4aaf11",
                "name": "phone",
                "value": "={{ $('Variáveis Globais').item.json.user_id }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "4aea932b-10ce-49d5-8e0c-c561676a8a22",
        "name": "Prepara User",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -6540,
          2140
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "operation": "update",
          "collection": "users",
          "updateKey": "phone",
          "fields": "=name,phone",
          "upsert": true,
          "options": {}
        },
        "id": "fc0be7bc-a336-42e8-a5ec-0b92cf8fefd1",
        "name": "MongoDB - Create User",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -6300,
          2140
        ],
        "credentials": {
          "mongoDb": {
            "id": "iRLHzNSsYJ662KTH",
            "name": "MongoDB - Chat - Blips"
          }
        }
      },
      {
        "parameters": {},
        "id": "a66dc7fe-1f1b-410d-9d43-5e688ae0a8d2",
        "name": "Merge - User",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2.1,
        "position": [
          -6040,
          1600
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "a481b5b5-85f3-495c-9301-fb5433b0dccc",
                "leftValue": "={{ !! $json[$('Variáveis Globais').item.json.assistant_id] }}",
                "rightValue": "'sadasdasdas'",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "2d597b59-2457-4624-9df7-1be43cce47e5",
        "name": "Possui Thread salva no banco?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -5800,
          1600
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "8c73c213-25d5-4b66-95fa-f8c9b4460480",
                "leftValue": "={{ $('MongoDB - Get User').item.json[$('Variáveis Globais').item.json.assistant_id] }}",
                "rightValue": "={{ $('Possui Thread salva no banco?').item.json[$('Variáveis Globais').item.json.assistant_id] }}",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "97a261d6-2627-4012-836d-ced1066a77a1",
        "name": "Mudou a thread_id?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -5600,
          1500
        ]
      },
      {
        "parameters": {
          "collection": "messages",
          "options": {},
          "query": "={\n  \"thread_id\": \"{{ $json[$('Variáveis Globais').first().json.assistant_id] }}\",\n  \"message_date\": {\"$gte\": \"{{$now.minus(6, 'hours').toISO()}}\"}\n}"
        },
        "id": "984d8b9e-6642-4847-b694-bd864d13da87",
        "name": "Conta as mensagens recentes",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -5400,
          1600
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "iRLHzNSsYJ662KTH",
            "name": "MongoDB - Chat - Blips"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "2f9b9d5a-e6c8-4052-961e-89a2e11d59f5",
                "leftValue": "={{ $('Variáveis Globais').item.json.message.trim() }}",
                "rightValue": "=/limpar_thread",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              },
              {
                "id": "6afa8f21-47c3-4ebf-9b3f-85c5694c94d4",
                "leftValue": "={{! $json._id }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "e1655e6b-bf8e-4962-83a6-32108a932fee",
        "name": "É para continuar a thread_id?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -4980,
          1600
        ],
        "executeOnce": true
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "e67f5454-b878-4de4-a5e0-9136f74539ad",
                "name": "thread_id",
                "value": "={{ $json.thread_id }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "291500e2-a83c-4650-9c0f-227923d8a050",
        "name": "Add thread_id",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -4740,
          1600
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "b9c8dcb8-7a7d-4a06-8ad2-6fc05f1694bf",
                "name": "phone",
                "value": "={{ $('Possui Thread salva no banco?').item.json.phone }}",
                "type": "string"
              },
              {
                "id": "322f9814-b3ff-45f8-9210-47e5ee4aaf11",
                "name": "={{ $('Variáveis Globais').item.json.assistant_id }}",
                "value": "={{ $json.id }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "892821fd-e0aa-4b87-bb9b-18e3e4c12963",
        "name": "Prepara atualização",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -4540,
          1920
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "operation": "update",
          "collection": "users",
          "updateKey": "phone",
          "fields": "={{ $('Variáveis Globais').item.json.assistant_id }}",
          "options": {}
        },
        "id": "b660f18d-93ef-4220-afad-f52640af10ce",
        "name": "Atualizar thread_id",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -4340,
          1920
        ],
        "credentials": {
          "mongoDb": {
            "id": "iRLHzNSsYJ662KTH",
            "name": "MongoDB - Chat - Blips"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "2f9b9d5a-e6c8-4052-961e-89a2e11d59f5",
                "leftValue": "={{ $('Variáveis Globais').item.json.message }}",
                "rightValue": "/limpar_thread",
                "operator": {
                  "type": "string",
                  "operation": "startsWith"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "49b2b9f1-9e9e-4617-9d40-ace1d3046470",
        "name": "Foi uma solicitação p/ limpar?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -5940,
          2120
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "0946679f-72ec-4479-b8b6-831d4274caad",
                "name": "output",
                "value": "Nova thread criada",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "3f1a1272-2628-4e18-abb5-e61444f5e673",
        "name": "Resposta chat1",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -5700,
          2120
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "2c72ca72-d1a4-4dc0-84e8-e882ecc1c42a",
                "name": "message",
                "value": "={{ $('Juntar Mensagens2').item.json.message }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "4bcb94f8-2123-4830-a835-ff9cf4292364",
        "name": "Set Message from Text",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -3900,
          1700
        ]
      },
      {
        "parameters": {},
        "id": "f32e1d4d-2f92-4c0a-a6cd-018ac2473c0d",
        "name": "Merge - Message",
        "type": "n8n-nodes-base.merge",
        "typeVersion": 2.1,
        "position": [
          -3300,
          1620
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "b9c8dcb8-7a7d-4a06-8ad2-6fc05f1694bf",
                "name": "user_id",
                "value": "={{ new String($('MongoDB - Get User').first().json._id).toString() }}",
                "type": "string"
              },
              {
                "id": "322f9814-b3ff-45f8-9210-47e5ee4aaf11",
                "name": "thread_id",
                "value": "={{ $('Add thread_id').item.json.thread_id }}",
                "type": "string"
              },
              {
                "id": "c124c295-55c0-4e1e-b489-393b63ca22f7",
                "name": "message",
                "value": "={{ $json.message }}",
                "type": "string"
              },
              {
                "id": "2c10a020-ae36-4d88-a9b1-4c125058d68f",
                "name": "message_date",
                "value": "={{ $now.toISO() }}",
                "type": "string"
              },
              {
                "id": "a572d77e-c0aa-4b6f-b44b-2baa0c02a9cb",
                "name": "assistant_id",
                "value": "={{ $('Variáveis Globais').item.json.assistant_id }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "ffefd017-8ccf-45df-a315-7f675cbdcb72",
        "name": "Prepara mensagem",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -3060,
          1620
        ],
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "operation": "insert",
          "collection": "messages",
          "fields": "user_id,thread_id,message,message_date,assistant_id",
          "options": {}
        },
        "id": "b790a2c8-ad36-414e-a972-dcb970377e9d",
        "name": "Insere a mensagem",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -2820,
          1620
        ],
        "credentials": {
          "mongoDb": {
            "id": "iRLHzNSsYJ662KTH",
            "name": "MongoDB - Chat - Blips"
          }
        }
      },
      {
        "parameters": {
          "collection": "messages",
          "options": {
            "sort": "{\"message_date\": 1}"
          },
          "query": "={\n  \"thread_id\": \"{{ $('Add thread_id').item.json.thread_id }}\",\n  \"process_date\": null\n}"
        },
        "id": "3748fc69-a717-4bda-9dcc-b9d7cde6a9c9",
        "name": "Busca as mensagens",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -2400,
          1620
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "iRLHzNSsYJ662KTH",
            "name": "MongoDB - Chat - Blips"
          }
        }
      },
      {
        "parameters": {
          "options": {}
        },
        "id": "88ce7c1d-235a-44b1-9bfd-a0bd2eff4489",
        "name": "Loop Over Items",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -3300,
          1900
        ]
      },
      {
        "parameters": {
          "jsCode": "const messagesArray = $('Busca as mensagens').all();\nlet allMessages = \"\";\n\nmessagesArray.forEach(item => {\n  allMessages += item.json.message + \"  \";\n});\n\nallMessages = allMessages.trim();\nreturn [{\"message\": allMessages}]"
        },
        "id": "813dcda3-82dd-4189-85e2-a04df343f194",
        "name": "Concatena todas mensagens",
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          -3060,
          1820
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "beed4a68-7ca4-480d-b203-3f43ca5c2ce5",
                "name": "process_date",
                "value": "={{ $now.toISO() }}",
                "type": "string"
              },
              {
                "id": "ed79557d-a9f1-4938-8639-2b3c86df2ce0",
                "name": "thread_id",
                "value": "={{ $('Prepara mensagem').item.json.thread_id }}",
                "type": "string"
              },
              {
                "id": "d5795955-d791-42b4-ad4e-a4c6b08bb79a",
                "name": "_id",
                "value": "={{ new String($json._id).toString() }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "c4af99f2-4747-4e66-bf4c-ef0aad152744",
        "name": "Define process_date",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -3060,
          2060
        ]
      },
      {
        "parameters": {
          "operation": "update",
          "collection": "messages",
          "updateKey": "_id",
          "fields": "process_date",
          "options": {}
        },
        "id": "b4f0eb51-2aae-4082-99e3-ecd815633ca5",
        "name": "Marca para processar",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1,
        "position": [
          -2820,
          2060
        ],
        "credentials": {
          "mongoDb": {
            "id": "iRLHzNSsYJ662KTH",
            "name": "MongoDB - Chat - Blips"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "303c1752-c985-409c-88af-294c58e07484",
                "leftValue": "={{!! $json.data[0].cancelled_at }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "false",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "11e0f1cb-7bf0-4fe5-becc-bde715c8419c",
        "name": "Se cancelado",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -1440,
          1920
        ]
      },
      {
        "parameters": {
          "content": "# **Gestão das Functions** \n",
          "height": 1357.4740201954464,
          "width": 2951.2588654648716,
          "color": 3
        },
        "id": "9fedfba6-a179-4e55-806f-6c4b107b004f",
        "name": "Sticky Note1",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -440,
          261.0465725108195
        ]
      },
      {
        "parameters": {
          "content": "# **Resposta** \n",
          "height": 709.8602809008241,
          "width": 858.57142633048,
          "color": 6
        },
        "id": "3e9a88c5-5ad5-4f7b-9d28-c60241a9af08",
        "name": "Sticky Note2",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -100.26503192454356,
          1620
        ]
      },
      {
        "parameters": {
          "content": "# **Espera Processamento Open AI** ",
          "height": 710.6937811131272,
          "width": 960.272849340224,
          "color": 4
        },
        "id": "95c7268e-1999-4ac7-92ef-4949781a608f",
        "name": "Sticky Note3",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -1060,
          1620
        ]
      },
      {
        "parameters": {
          "content": "# **Cadastro e Controle de Threadas no Mongo** \n",
          "height": 1002.0602494127438,
          "width": 6359.718387578165
        },
        "id": "d2891947-d985-4493-b16b-e2e9b207bf1a",
        "name": "Sticky Note4",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -7420,
          1329.0038148554077
        ]
      },
      {
        "parameters": {
          "content": "# **Retém e Concatena mensagens seguidas**",
          "height": 782.0088651269202,
          "width": 1149.5969469949175,
          "color": 5
        },
        "id": "b8f50322-b037-4cd8-abf0-a13528cf18da",
        "name": "Sticky Note5",
        "type": "n8n-nodes-base.stickyNote",
        "typeVersion": 1,
        "position": [
          -3381.693213179652,
          1520
        ]
      },
      {
        "parameters": {
          "options": {
            "reset": "={{ $node[\"Para cada ação necessária\"].context[\"done\"] }}"
          }
        },
        "id": "2b1c710c-7980-477e-833f-b90eb0f4bc36",
        "name": "Para cada ação necessária",
        "type": "n8n-nodes-base.splitInBatches",
        "typeVersion": 3,
        "position": [
          -20,
          1380
        ]
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "options": {}
        },
        "id": "402c377f-92cd-4ec9-b9a4-64953d7ee383",
        "name": "Junta Resultados",
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          260,
          1040
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c49761c9-bbfa-4a86-8d62-396ebeeebc5d",
                "name": "output",
                "value": "={{ $json.data }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "84b7effa-7576-4905-ad60-5117e863bc61",
        "name": "Prepara Resultado",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          480,
          1040
        ],
        "retryOnFail": true
      },
      {
        "parameters": {
          "amount": 2,
          "unit": "seconds"
        },
        "id": "ee072000-9710-4229-8929-3bc085d4b1c2",
        "name": "Espera rodar um pouco",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1,
        "position": [
          -640,
          1963
        ],
        "webhookId": "21a21f59-4828-4b7c-a5cd-d70bb1cdebd8"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "98a5af91-f163-4672-9d53-9bee20c97303",
                "leftValue": "={{ $json.last_error.code }}",
                "rightValue": "rate_limit_exceeded",
                "operator": {
                  "type": "string",
                  "operation": "equals",
                  "name": "filter.operator.equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "df3694d2-c37f-4a82-8876-b4161596a353",
        "name": "Se Rate Limit",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -400,
          1900
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9be99488-b9db-4adf-bd48-7d7109f34e01",
                "name": "message",
                "value": "={{ $('Concatena todas mensagens').item.json.message }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "6806000b-a9ef-4e7b-9c2a-71e12812858d",
        "name": "Reprocessa Mensagem",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -260,
          2040
        ]
      },
      {
        "parameters": {
          "collection": "ativacoes",
          "options": {
            "limit": 1,
            "sort": "{\n  \"data_hora_envio\": -1\n}"
          },
          "query": "={\n  \"telefone\": \"{{ $('Variáveis Globais').first().json.phone_forcado }}\"\n}"
        },
        "id": "b68537af-9a02-4495-9067-db149e78920e",
        "name": "Busca mensagem de ativação",
        "type": "n8n-nodes-base.mongoDb",
        "typeVersion": 1.1,
        "position": [
          -2140,
          1820
        ],
        "alwaysOutputData": true,
        "credentials": {
          "mongoDb": {
            "id": "iRLHzNSsYJ662KTH",
            "name": "MongoDB - Chat - Blips"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://api.openai.com/v1/threads/{{ $('Add thread_id').first().json.thread_id }}/runs",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              }
            ]
          },
          "options": {}
        },
        "id": "29f12148-5fd6-4d90-a769-723ffbfac9a1",
        "name": "Lista Runs",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          -1660,
          1920
        ],
        "retryOnFail": true,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://api.openai.com/v1/threads/{{ $json.data[0].thread_id }}/runs/{{ $('Lista Runs').first().json.first_id }}/cancel ",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              }
            ]
          },
          "options": {}
        },
        "id": "cc1dfde9-f930-4964-9ee7-b64bae963199",
        "name": "Cancel Run",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          -1220,
          1920
        ],
        "retryOnFail": true,
        "executeOnce": false,
        "maxTries": 5,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://api.openai.com/v1/threads/{{ $json.thread_id }}/messages?order=desc",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "options": {}
        },
        "id": "0a7ee125-a634-45ab-8c4f-3f17a44413cf",
        "name": "Pega Resposta Open AI",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          -400,
          1720
        ],
        "retryOnFail": true,
        "maxTries": 5,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://api.openai.com/v1/threads/{{ $('Get Run Status').item.json[\"thread_id\"] }}/runs/{{ $('Get Run Status').item.json[\"id\"] }}/submit_tool_outputs",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"tool_outputs\":{{ $json.output }}\n}\n",
          "options": {}
        },
        "id": "a6adaa73-49d9-4e95-92df-d498de4d98ad",
        "name": "Insere Output",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          700,
          1040
        ],
        "retryOnFail": true,
        "maxTries": 5,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/threads",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              },
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              }
            ]
          },
          "options": {}
        },
        "id": "ffedecf0-7e6f-4b48-9074-08847f28e543",
        "name": "Criar Thread",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          -4740,
          1920
        ],
        "retryOnFail": true,
        "maxTries": 5,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "7e8aee3a-54b3-47b8-b546-3f90fb3f036a",
                "name": "output",
                "value": "={{ $json.resposta }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "51188603-b401-45a9-b6e2-21aa259b8431",
        "name": "Resposta chat",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          240,
          2000
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "85e6ca8f-6b7b-4af4-980f-7a72a7d9d088",
                "name": "resposta",
                "value": "={{$json.data[0].content[0].text.value.replaceAll('\\n', '\\\\n').replaceAll('\"', '')}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "4900f01b-8a8b-458d-a6f3-13b0d02bcf5f",
        "name": "Formata",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -80,
          1720
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "ccc349c8-e64f-45d7-bd3f-551a8a58a2ee",
                "leftValue": "={{ $('Variáveis Globais').item.json.chat }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "ead4861a-6749-40e8-954e-9a368af05bb8",
        "name": "É chat?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -7060,
          1620
        ]
      },
      {
        "parameters": {
          "aggregate": "aggregateAllItemData",
          "destinationFieldName": "response",
          "options": {}
        },
        "id": "d4bad719-d234-4518-bf70-1bc1a0736a95",
        "name": "Aggregate",
        "type": "n8n-nodes-base.aggregate",
        "typeVersion": 1,
        "position": [
          1920,
          900
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"text\": \"{{ $json.resposta }}\"\n}",
          "options": {}
        },
        "id": "36fc09d4-29f4-4945-82e0-571c9d9c69d8",
        "name": "Respond to Webhook1",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          240,
          2160
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "957ba458-7a73-4c85-aa32-e0601292709b",
                      "leftValue": "={{ $('Variáveis Globais').item.json.message_type }}",
                      "rightValue": "image",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Image"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $('Variáveis Globais').item.json.message_type }}",
                      "rightValue": "text",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Text"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "ff160489-60f4-4fde-b3e7-0f69c9593f90",
                      "leftValue": "={{ $('Variáveis Globais').item.json.message_type }}",
                      "rightValue": "audio",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "Audio"
              }
            ]
          },
          "options": {}
        },
        "id": "e134cee3-8d4d-4fd1-8488-4c5ee6565ed1",
        "name": "Tipo de Mensagem",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          -4340,
          1700
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "65586f74-346f-4f40-bc3d-8b17ca6918c5",
                "leftValue": "={{ $('Variáveis Globais').item.json.repetir }}",
                "rightValue": "0",
                "operator": {
                  "type": "string",
                  "operation": "notEquals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "0b467bda-62d5-4a00-810c-e5fb13aeb819",
        "name": "enviar ultima resposta?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -4540,
          1600
        ]
      },
      {
        "parameters": {
          "url": "=https://api.openai.com/v1/threads/{{ $json.thread_id }}/messages?order=desc",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "options": {}
        },
        "id": "f582ece0-ff90-4ea8-b369-bd3fba039f4b",
        "name": "Pega Resposta Open AI1",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          -4340,
          1420
        ],
        "retryOnFail": true,
        "maxTries": 5,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "85e6ca8f-6b7b-4af4-980f-7a72a7d9d088",
                "name": "resposta",
                "value": "={{$json.data[0].content[0].text.value.replaceAll(/【[^】]*】/g, \"\").replaceAll('\\n', 'QUEBRALINHA')}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "f3db2f8a-ff39-4104-9b3d-694528f508e0",
        "name": "Formata1",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -4120,
          1420
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "d5ede31e-cae1-4745-ad18-18d0d651b23c",
                "leftValue": "={{ $json.resposta }}",
                "rightValue": "ativação",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "a9d6fc86-6479-48f5-b4a8-06a615c0819b",
        "name": "Fala da mensagem de ativação?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -3900,
          1420
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"text\": \"Vou te encaminhar para um atendente\"\n}",
          "options": {}
        },
        "id": "5a63b61d-e5ad-4a09-9a2a-3625332cb2a9",
        "name": "Encaminha Atendimento",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          -3720,
          1340
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "={\n  \"text\": \"{{ $json.resposta }}\"\n}",
          "options": {}
        },
        "id": "44b576a8-e6aa-46e0-bcb8-18bb9a9173ca",
        "name": "Responde última mensagem",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          -3720,
          1500
        ]
      },
      {
        "parameters": {
          "authentication": "oAuth2",
          "resource": "message",
          "guildId": {
            "__rl": true,
            "value": "1258059672171319316",
            "mode": "list",
            "cachedResultName": "Bot Teste",
            "cachedResultUrl": "https://discord.com/channels/1258059672171319316"
          },
          "channelId": {
            "__rl": true,
            "value": "1278683051869863936",
            "mode": "list",
            "cachedResultName": "log",
            "cachedResultUrl": "https://discord.com/channels/1258059672171319316/1278683051869863936"
          },
          "content": "=Erro no fluxo {{ $('Variáveis Globais - Code').item.json.phone_forcado }} - {{ $now.format('dd/MM/yy - HH:mm') }}",
          "options": {}
        },
        "id": "a8234200-f221-4bcd-8092-db89fe744e08",
        "name": "Discord",
        "type": "n8n-nodes-base.discord",
        "typeVersion": 2,
        "position": [
          -3540,
          1340
        ],
        "credentials": {
          "discordOAuth2Api": {
            "id": "2e0894liy8HiObFy",
            "name": "Discord Bot"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "34cb3bc8-079f-43b5-8f32-78fefbc897dc",
                "name": "assistant_id",
                "value": "={{ $json.assistente || 'asst_EDCYDuJmjAFsB9R8lW0JpVhy' }}",
                "type": "string"
              },
              {
                "id": "b6ff9a48-6fe6-4808-8a40-d6edbb9c2346",
                "name": "user_id",
                "value": "={{ $json.body.id}}",
                "type": "string"
              },
              {
                "id": "7a61cd22-7f0c-4c04-a3ed-6acf9f979424",
                "name": "message_type",
                "value": "=text",
                "type": "string"
              },
              {
                "id": "8b78c832-8cf3-430f-83b0-7bbca38e4140",
                "name": "=message",
                "value": "={{ $json.body.content.replace(/@\\d+/g, '').trim() === 'null' ? 'Olá' : $json.body.content.replace(/@\\d+/g, '').replaceAll('undefined', '').trim()}}",
                "type": "string"
              },
              {
                "id": "adf11de6-a3ee-4e3e-aed5-5a6a3025202d",
                "name": "chat",
                "value": "={{ $json.body['user-agent'] == 'chat'}}",
                "type": "boolean"
              },
              {
                "id": "74b31986-b940-4961-94ac-188108032c9c",
                "name": "audios",
                "value": "={{ $json.body.audios.split(',').filter(item => item.length > 0) }}",
                "type": "array"
              },
              {
                "id": "59b01587-dc59-4cb3-9bce-e7daa0f0c6de",
                "name": "em_manutencao",
                "value": false,
                "type": "boolean"
              },
              {
                "id": "1fb719f0-1815-42ba-b967-37ebc74fae03",
                "name": "nome_agente",
                "value": "Esperanza",
                "type": "string"
              },
              {
                "id": "d8575154-cf18-4c31-8270-4d3f26151761",
                "name": "phone_forcado",
                "value": "={{ $json.body.id.replace(/\\D/g, '').startsWith('55') ? $json.body.id.replace(/\\D/g, '').slice(2) : $json.body.id.replace(/\\D/g, '') }}",
                "type": "string"
              },
              {
                "id": "9d1a67d6-4994-45b4-9a1f-87de2bbd28cc",
                "name": "images",
                "value": "={{ $json.body.images.split(',').filter(item => item.length > 0) }}",
                "type": "array"
              },
              {
                "id": "7fcef8f4-153d-4710-a13f-4c56342f338a",
                "name": "files",
                "value": "={{ $json.body.files.split(',').filter(item => item.length > 0) }}",
                "type": "array"
              },
              {
                "id": "04da73dc-8651-4f57-9d03-f81ff815a5a2",
                "name": "repetir",
                "value": "={{ $json.body.repetir || '0'}}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "4d5e51bf-78f3-4104-ad98-b3c7c4a3894a",
        "name": "Variáveis Globais",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -10780,
          1740
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "e974bbea-4269-45f3-a6eb-063107c1afe0",
                "leftValue": "={{ $json.text }}",
                "rightValue": "TRUE",
                "operator": {
                  "type": "string",
                  "operation": "contains"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "2504ab9c-3aaf-422b-a65d-8a92115d4c7b",
        "name": "É pra encerrar?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -7840,
          1740
        ]
      },
      {
        "parameters": {
          "respondWith": "json",
          "responseBody": "{\n  \"text\": \"encerrar\"\n}\n",
          "options": {}
        },
        "id": "34926e56-c1e4-47d0-a81f-dc94a99e571d",
        "name": "Respond to Webhook",
        "type": "n8n-nodes-base.respondToWebhook",
        "typeVersion": 1.1,
        "position": [
          -7640,
          1460
        ]
      },
      {
        "parameters": {
          "promptType": "define",
          "text": "=*Task:* Você é um interpretador de texto de um chat. Sua função é verificar se a mensagem do usuário indica a intenção de encerrar o atendimento. Responda apenas TRUE ou FALSE.\n\n*Critérios para TRUE (encerramento de conversa):*\n- O usuário se despede explicitamente ou indica que deseja encerrar a conversa.\n  - Exemplos:\n    - \"Obrigado, até mais\"\n    - \"Encerrar atendimento\"\n    - \"Até logo, tchau\"\n    - \"Foi ótimo falar com você, até a próxima\"\n    - \"Agradeço a ajuda, adeus\"\n    - \"Vou encerrar a conversa aqui\"\n    - \"Não preciso de mais nada, obrigado\"\n    - \"ok, obrigado\"\n    - \"certo, obrigado\"\n    - \"Ok\"\n    - \"Combinado\"\n    - \"Fechou\"\n    - \"Valeu\"\n\n*Critérios para FALSE (não encerrando a conversa):*\n- O usuário está pedindo para cancelar um contrato ou compra, ou quer falar com um representante.\n  - Exemplos:\n    - \"Quero cancelar um contrato/compra\"\n    - \"Quero falar com um atendente\"\n    - \"Preciso de ajuda para cancelar meu serviço\"\n    - \"Pode transferir para um representante?\"\n    - \"Como faço para cancelar minha assinatura?\"\n    - \"Preciso falar com o suporte técnico\"\n\n*Mensagem do usuário:* {{$json.message}}"
        },
        "id": "c9bdaab9-5f85-442a-bdf0-6af6d402239e",
        "name": "Basic LLM Chain",
        "type": "@n8n/n8n-nodes-langchain.chainLlm",
        "typeVersion": 1.4,
        "position": [
          -8200,
          1740
        ]
      },
      {
        "parameters": {
          "model": {
            "__rl": true,
            "value": "gpt-4o-mini",
            "mode": "list",
            "cachedResultName": "gpt-4o-mini"
          },
          "options": {}
        },
        "id": "2381d96f-0190-455c-aefe-2bb8c259fea1",
        "name": "OpenAI Model",
        "type": "@n8n/n8n-nodes-langchain.lmOpenAi",
        "typeVersion": 1,
        "position": [
          -8180,
          1940
        ],
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        }
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "2d28e7b9-2392-46e2-8cd7-0a6ae124adf5",
                "name": "message",
                "value": "={{ \n  $('Juntar Mensagens1').item.json.message \n  + '\\n' \n  + ($json.ImageText && $json.ImageText.filter(image => image !== 'null').length > 0 \n      ? '\\n<Comprovante>\\n' \n        + $json.ImageText\n          .filter(image => image !== 'null')\n          .map(image => JSON.stringify(image, null, 2))\n          .join('\\n')\n          .replaceAll('[', '')\n          .replaceAll(']', '')\n          .replaceAll('\"', '')\n          .trim() \n        + '\\n</Comprovante>' \n      : '') \n}}\n",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "42fb13a1-b2c3-4fc3-a129-3056b416da4c",
        "name": "Juntar Mensagens2",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -8420,
          1740
        ]
      },
      {
        "parameters": {
          "workflowId": "gnNdR6VzpSL8GoKN",
          "options": {}
        },
        "id": "62f7d3b9-111c-4baf-af35-f0496c4065c0",
        "name": "Transcreve Imagens",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1,
        "position": [
          -8620,
          1460
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "60cd8f23-87ba-4eec-9035-aa4eae8d1342",
                "leftValue": "={{ $('Variáveis Globais').item.json.images }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "id": "b0e00120-629e-4712-b277-0cf56bbaf69c",
        "name": "Tem Imagem?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -8820,
          1740
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "2d28e7b9-2392-46e2-8cd7-0a6ae124adf5",
                "name": "message",
                "value": "={{ \n  $('Juntar Mensagens').item.json.message \n  + '\\n' \n  + ($json.FileText && $json.FileText.filter(file => file !== 'null').length > 0 \n      ? '\\n<Comprovante>\\n' \n        + $json.FileText\n          .filter(file => file !== 'null')\n          .map(file => JSON.stringify(file, null, 2))\n          .join('\\n')\n          .replaceAll('[', '')\n          .replaceAll(']', '')\n          .replaceAll('\"', '')\n          .trim() \n        + '\\n</Comprovante>' \n      : '') \n}}\n",
                "type": "string"
              },
              {
                "id": "6944b1e1-01d8-4e16-bddf-b088aff438f3",
                "name": "images",
                "value": "={{ $('Variáveis Globais - Code').item.json.images}}",
                "type": "array"
              },
              {
                "id": "e807624b-b17e-4788-8bc7-95c9c75671cc",
                "name": "telefone",
                "value": "={{ $('Variáveis Globais - Code').item.json.phone_forcado }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "8ec624ae-6576-4af8-978f-7f6480b91ed8",
        "name": "Juntar Mensagens1",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -9060,
          1740
        ]
      },
      {
        "parameters": {
          "workflowId": "6Qp4o7eNqi1fSRzz",
          "options": {}
        },
        "id": "1162add1-9dbb-4010-859e-7ba92b8b2f71",
        "name": "Transcreve PDFs",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1,
        "position": [
          -9320,
          1460
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "60cd8f23-87ba-4eec-9035-aa4eae8d1342",
                "leftValue": "={{ $('Variáveis Globais').item.json.files }}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "id": "ab9b0c21-cf99-4d5a-8301-c990f98c20f7",
        "name": "Tem Arquivo?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -9540,
          1740
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "6cce3c0b-ec1f-475a-8bce-c6cb6cdd8016",
                "name": "message",
                "value": "={{ ($json.AudioText ? JSON.stringify($json.AudioText, null, 2) : \"\").replaceAll('[', '').replaceAll(']', ''). replaceAll('\"', '').trim() + '\\n' + $('Variáveis Globais - Code').item.json.message}}",
                "type": "string"
              },
              {
                "id": "e4791d1d-3c1e-4b47-a8c2-e26b7486db53",
                "name": "files",
                "value": "={{ $('Variáveis Globais - Code').item.json.files }}",
                "type": "array"
              },
              {
                "id": "35363996-3a05-4dc4-9b4e-9ef0baa96bea",
                "name": "telefone",
                "value": "={{ $('Variáveis Globais - Code').item.json.phone_forcado }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "bdfb1ff1-6b0c-4935-86bc-712d6e6eed4a",
        "name": "Juntar Mensagens",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -9800,
          1740
        ]
      },
      {
        "parameters": {
          "workflowId": "m1hGhj4M5EsMTAn4",
          "options": {}
        },
        "id": "a4c5dc76-b837-4a6a-9669-c2673f200d21",
        "name": "Transcreve Áudios",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1,
        "position": [
          -10060,
          1460
        ]
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "48862302-18b6-4ee8-bc64-21099312dba8",
                "leftValue": "={{$json.audios}}",
                "rightValue": "",
                "operator": {
                  "type": "array",
                  "operation": "notEmpty",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "67811ed9-43eb-4b47-b958-ee6fde72502f",
        "name": "Tem áudio?",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          -10280,
          1740
        ]
      },
      {
        "parameters": {},
        "id": "3230c051-85c4-4603-a935-005575c6579b",
        "name": "Execute Workflow Trigger",
        "type": "n8n-nodes-base.executeWorkflowTrigger",
        "typeVersion": 1,
        "position": [
          -11600,
          2100
        ]
      },
      {
        "parameters": {
          "amount": 1
        },
        "id": "30626c6b-1672-4ec2-9fcf-4d8b1e5c6625",
        "name": "Wait",
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          -2600,
          1620
        ],
        "webhookId": "b54691e3-e860-4c2a-929d-6cf64a3c8cb6"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "caseSensitive": true,
              "leftValue": "",
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "ccc349c8-e64f-45d7-bd3f-551a8a58a2ee",
                "leftValue": "={{ $('Variáveis Globais').first().json.chat }}",
                "rightValue": "",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "id": "72fbbb83-6862-4bc0-b41e-ac7cbd93491f",
        "name": "É chat?3",
        "type": "n8n-nodes-base.if",
        "typeVersion": 2,
        "position": [
          60,
          2080
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://runtime.hyperflowapis.global/api/dneeXMnM7/cobranca-ativo-n8n/EsperanzaV2",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "client_id",
                "value": "d65393f4-f062-493a-bfd0-c36aeb5d21b0"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "mensagem_teste",
                "value": "={{ $json.resposta }}"
              }
            ]
          },
          "options": {}
        },
        "id": "e0ef59c8-e546-4602-8016-4eb5b5d2cb77",
        "name": "HTTP Request",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          460,
          2080
        ]
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://api.openai.com/v1/threads/{{ $('Prepara mensagem').first().json[\"thread_id\"] }}/messages",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "role",
                "value": "user"
              },
              {
                "name": "content",
                "value": "={{ $('Concatena todas mensagens').first().json.message.trim() }} \n\n<MetaDados> \n  - O telefone associado é o: {{ $('Variáveis Globais - Code').item.json.user_id }}\n<MetaDados>\n"
              }
            ]
          },
          "options": {}
        },
        "id": "57955c44-bbfa-412b-9452-8fcdb4fbdfaf",
        "name": "Criar a Mensagem",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          -1860,
          1820
        ],
        "retryOnFail": true,
        "maxTries": 5,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        },
        "onError": "continueErrorOutput"
      },
      {
        "parameters": {
          "url": "=https://api.openai.com/v1/threads/{{ $json[\"thread_id\"] }}/runs/{{ $json[\"id\"] }}",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              }
            ]
          },
          "options": {}
        },
        "id": "55ff060c-58ab-4455-b11f-6dd9368b7728",
        "name": "Get Run Status",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          -1000,
          1720
        ],
        "retryOnFail": true,
        "maxTries": 5,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://api.openai.com/v1/threads/{{ $json.thread_id }}/runs",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "OpenAI-Beta",
                "value": "assistants=v2"
              }
            ]
          },
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "assistant_id",
                "value": "={{ $('Variáveis Globais').first().json.assistant_id }}"
              },
              {
                "name": "tool_choice",
                "value": "auto"
              },
              {
                "name": "parallel_tool_calls",
                "value": "={{ false }}"
              }
            ]
          },
          "options": {}
        },
        "id": "9a0ee4b1-64bb-4359-810f-5874413735a2",
        "name": "Run Assistant",
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.1,
        "position": [
          -1660,
          1720
        ],
        "retryOnFail": true,
        "maxTries": 5,
        "credentials": {
          "openAiApi": {
            "id": "erBLFgb3zHf0C8ux",
            "name": "Open Ai - Cobrança"
          }
        }
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "leftValue": "={{ $json.status }}",
                      "rightValue": "queued",
                      "operator": {
                        "type": "string",
                        "operation": "equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "queued"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "ecd44d0c-b93e-4977-ae74-8c87eae4cf20",
                      "leftValue": "={{ $json.status }}",
                      "rightValue": "in_progress",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "in_progress"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "6f6841ae-8845-4659-9e06-06e5bd4843df",
                      "leftValue": "={{ $json.status }}",
                      "rightValue": "failed",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "failed"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "6cc26ecf-79af-4d91-bb3f-a617646e3fc8",
                      "leftValue": "={{ $json.status }}",
                      "rightValue": "completed",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "completed"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "0f93b1ee-1a9c-4586-86f8-55e0a180ca04",
                      "leftValue": "={{ $json.status }}",
                      "rightValue": "expired",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "expired"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "5e7ecc7f-ecee-439c-aa0e-80a7e110726a",
                      "leftValue": "={{ $json.status }}",
                      "rightValue": "=requires_action",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "requires_action"
              }
            ]
          },
          "options": {}
        },
        "id": "23be1c96-881f-48f7-b5a7-3897b9f8b006",
        "name": "Switch Status",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          -780,
          1700
        ]
      },
      {
        "parameters": {
          "rules": {
            "values": [
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "490075ab-7aeb-4232-8633-b008558bafc5",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "=function_consultas",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "function_consultas"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "f164a287-6ebf-446c-88e4-4597afb4637d",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "function_equipamentos",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "function_equipamentos"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "65a8dddd-dfbb-45a0-87f6-4a0eb5fe4f42",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "function_financeiro",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "function_financeiro"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "f00c39c3-9a2c-4b81-8ff4-194b91c1b89b",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "function_pagamentos",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "function_pagamentos"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "561aa8c6-591e-4a8e-bccb-55dfefc77828",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "consulta_bloqueantes",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "consulta_bloqueantes"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "5368e73f-8180-4b05-a393-9bc6472cb8b1",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "consulta_cobranca",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "consulta_cobranca"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "9a98a6db-c255-4d63-a91b-815a835c3121",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "consulta_futuros",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "consulta_futuros"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "58b235fa-7840-4ad2-8b93-d647f8142149",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "consulta_pagos",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "consulta_pagos"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "f388978a-259b-42f5-ba68-e0ba67428993",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "gerar_pagamento",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "gerar_pagamento"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "0b332685-04cd-4639-8055-14160bd3ad6c",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "liberacao_confianca",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "liberacao_confianca"
              },
              {
                "conditions": {
                  "options": {
                    "caseSensitive": true,
                    "leftValue": "",
                    "typeValidation": "strict"
                  },
                  "conditions": [
                    {
                      "id": "131f30fb-7569-4268-b608-2ca9eb8144f0",
                      "leftValue": "={{ $json.properties.function.name }}",
                      "rightValue": "perguntar_salvador",
                      "operator": {
                        "type": "string",
                        "operation": "equals",
                        "name": "filter.operator.equals"
                      }
                    }
                  ],
                  "combinator": "and"
                },
                "renameOutput": true,
                "outputKey": "perguntar_salvador"
              }
            ]
          },
          "options": {}
        },
        "id": "fd622cd4-8b40-4608-a376-f2750072c958",
        "name": "Escolhe a tool que deve ser utilizada",
        "type": "n8n-nodes-base.switch",
        "typeVersion": 3,
        "position": [
          700,
          1300
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "kbuuN4jwVRflRzPl",
            "mode": "list",
            "cachedResultName": "Agente Alfa"
          },
          "options": {}
        },
        "id": "9d4f2a7e-5ce2-4510-a74c-bfa65bc23f13",
        "name": "function_consultas",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          260
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "kbuuN4jwVRflRzPl",
            "mode": "list",
            "cachedResultName": "Agente Alfa"
          },
          "options": {}
        },
        "id": "5c718929-4fe3-44f8-8d0d-3039eeaa8091",
        "name": "function_equipamentos",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          420
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "kbuuN4jwVRflRzPl",
            "mode": "list",
            "cachedResultName": "Agente Alfa"
          },
          "options": {}
        },
        "id": "024d1c10-271d-4cf0-a4cf-2a9a8fd2643c",
        "name": "function_financeiro",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          580
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "BPqICS858uRBu6qm",
            "mode": "list",
            "cachedResultName": "Agente Pagamentos"
          },
          "options": {}
        },
        "id": "424f1c55-2058-4efb-9503-5ec74369608b",
        "name": "function_pagamentos",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          740
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "AIqTlhFmd3RzNdd6",
            "mode": "list",
            "cachedResultName": "Esperanza V2 - func - consulta_bloqueantes"
          },
          "options": {}
        },
        "id": "13d733b6-0b13-4d64-b61c-1ee5d42e8feb",
        "name": "consulta_bloqueantes",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          900
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "d8yCYU4TGWhAJuyw",
            "mode": "list",
            "cachedResultName": "Esperanza V2 - func - consulta_cobranca"
          },
          "options": {}
        },
        "id": "0887ef00-4374-4e09-a287-45b6d33c861a",
        "name": "consulta_cobranca",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          1060
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "mWm20N4OFKfpzq0D",
            "mode": "list",
            "cachedResultName": "Esperanza V2 - func - consulta_futuros"
          },
          "options": {}
        },
        "id": "d810e213-ee34-4f53-85f9-81c9c9a962cb",
        "name": "consulta_futuros",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          1220
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "VHZ04dx6Z7T8tQgq",
            "mode": "list",
            "cachedResultName": "Esperanza V2 - func - consulta_pagos"
          },
          "options": {}
        },
        "id": "267d400b-2511-41df-90fe-41e1a55da794",
        "name": "consulta_pagos",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          1380
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "VNnMAP6IagVDLbw7",
            "mode": "list",
            "cachedResultName": "Assistente Cobranca - func - gerar_pagamento"
          },
          "options": {}
        },
        "id": "3fda509d-c885-4917-9677-9697843bf8a2",
        "name": "gerar_pagamento",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          1540
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "F5qkga5trbTqYFJA",
            "mode": "list",
            "cachedResultName": "Assistente Cobranca - func - liberacao_confianca"
          },
          "options": {}
        },
        "id": "79c6ec9f-f928-4096-b2e5-f3ef5fad2633",
        "name": "liberacao_confianca",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          1700
        ]
      },
      {
        "parameters": {
          "workflowId": {
            "__rl": true,
            "value": "ve026aJL5FvMXdPU",
            "mode": "list",
            "cachedResultName": "Assistente Suporte Neurônio - Salvador"
          },
          "options": {}
        },
        "id": "7faff538-f762-4882-816c-5c6ec2cbfe7b",
        "name": "perguntar_salvador",
        "type": "n8n-nodes-base.executeWorkflow",
        "typeVersion": 1.1,
        "position": [
          1260,
          1860
        ]
      },
      {
        "parameters": {},
        "id": "40e9a985-1597-42a7-a4b1-06287ee1e741",
        "name": "Chat Trigger",
        "type": "@n8n/n8n-nodes-langchain.chatTrigger",
        "typeVersion": 1,
        "position": [
          -11600,
          1920
        ],
        "webhookId": "3dff0f16-5580-4fc2-8586-21210dcf51b2"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "alfa",
          "options": {}
        },
        "id": "d7090f15-b955-447b-90a8-2cf7773ed18b",
        "name": "Webhook Zap",
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 1.1,
        "position": [
          -11600,
          1740
        ],
        "webhookId": "ab6986af-bd2e-476d-b2e9-27c95ec13d01"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "9a6ac739-b3c8-4011-8d1b-403e9f655893",
                "name": "id",
                "value": "={{ $json.id_agente }}",
                "type": "string"
              },
              {
                "id": "21237808-e3f5-4d82-ad6f-28ad18e62cc5",
                "name": "name",
                "value": "={{ $json.nome_agente }}",
                "type": "string"
              },
              {
                "id": "1359cb8e-cb38-45b2-9d37-722e05139194",
                "name": "arguments.mensagem",
                "value": "={{ $json.arguments.solicitacao + ($json.arguments.nufin ? ' nufin: ' + $json.arguments.nufin : '' ) + ($json.arguments.cnpj ? ' CNPJ: ' + $json.arguments.cnpj : '' ) }}",
                "type": "string"
              },
              {
                "id": "5ba36edc-81e2-4daa-bd00-0261a85d3691",
                "name": "cnpj",
                "value": "={{ $json.arguments.cnpj }}",
                "type": "string"
              },
              {
                "id": "817bd09b-fa68-482b-acd1-80b890cbef15",
                "name": "telefone",
                "value": "={{ $json.arguments.telefone }}",
                "type": "string"
              },
              {
                "id": "499bfe3f-3b43-495a-8770-64c660e90a90",
                "name": "exemplo",
                "value": "={{ $json.arguments.id }}",
                "type": "string"
              },
              {
                "id": "d28e89a8-2435-43d6-9279-bcbd0edfe24c",
                "name": "assistente",
                "value": "={{ $json.arguments.assistente }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "id": "6d8fb16d-9827-4b12-9c31-f9b1aea77fe7",
        "name": "Se for chamada de função",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          -11340,
          2100
        ]
      },
      {
        "parameters": {
          "mode": "raw",
          "jsonOutput": "={\n  \"body\": {\n    \"type\": \"text\",\n    \"id\": \"{{ $json.id + $json.name }}\",\n    \"content\": \"{{ $json.chatInput || $json.arguments.mensagem }}\",\n    \"user-agent\": \"chat\"\n  },\n\n  \"assistente\": \"{{ $json.assistente }}\"\n}\n",
          "options": {}
        },
        "id": "9d857a49-1055-445c-b177-c1834f740ec8",
        "name": "Convert to Webhook",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.3,
        "position": [
          -11080,
          1920
        ]
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "4af2f29b-283d-42ac-91fd-1faef706fba5",
                "name": "id_agente",
                "value": "={{ $('Variáveis Globais').first().json.assistant_id }}",
                "type": "string"
              },
              {
                "id": "6a775885-e6eb-45c9-b657-6fa5f23a0deb",
                "name": "nome_agente",
                "value": "={{ $('Variáveis Globais').item.json.nome_agente +  $('Variáveis Globais').item.json.user_id}}",
                "type": "string"
              }
            ]
          },
          "includeOtherFields": true,
          "options": {}
        },
        "id": "7b7c4d72-1861-4efc-b911-da4824b53628",
        "name": "Argumentos + Id",
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          480,
          1380
        ]
      }
    ],
    "connections": {
      "Captura Tool Calls": {
        "main": [
          [
            {
              "node": "Split Out",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split Out": {
        "main": [
          [
            {
              "node": "Para cada ação necessária",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Separa Arguments": {
        "main": [
          [
            {
              "node": "Argumentos + Id",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Response": {
        "main": [
          [
            {
              "node": "Tool Call ID",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tool Call ID": {
        "main": [
          [
            {
              "node": "Para cada ação necessária",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Preparta thread_id": {
        "main": [
          [
            {
              "node": "Add thread_id",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Variáveis Globais - Code": {
        "main": [
          [
            {
              "node": "Tem áudio?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Está em manutenção?": {
        "main": [
          [
            {
              "node": "É chat?",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "MongoDB - Get User",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "MongoDB - Get User": {
        "main": [
          [
            {
              "node": "If - User Exists",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If - User Exists": {
        "main": [
          [
            {
              "node": "Merge - User",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Prepara User",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepara User": {
        "main": [
          [
            {
              "node": "MongoDB - Create User",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "MongoDB - Create User": {
        "main": [
          [
            {
              "node": "Merge - User",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge - User": {
        "main": [
          [
            {
              "node": "Possui Thread salva no banco?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Possui Thread salva no banco?": {
        "main": [
          [
            {
              "node": "Mudou a thread_id?",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Criar Thread",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Mudou a thread_id?": {
        "main": [
          [
            {
              "node": "Preparta thread_id",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Conta as mensagens recentes",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Conta as mensagens recentes": {
        "main": [
          [
            {
              "node": "É para continuar a thread_id?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "É para continuar a thread_id?": {
        "main": [
          [
            {
              "node": "Add thread_id",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Criar Thread",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Add thread_id": {
        "main": [
          [
            {
              "node": "enviar ultima resposta?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepara atualização": {
        "main": [
          [
            {
              "node": "Atualizar thread_id",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Atualizar thread_id": {
        "main": [
          [
            {
              "node": "Foi uma solicitação p/ limpar?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Foi uma solicitação p/ limpar?": {
        "main": [
          [
            {
              "node": "Resposta chat1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Merge - User",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Resposta chat1": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Set Message from Text": {
        "main": [
          [
            {
              "node": "Merge - Message",
              "type": "main",
              "index": 1
            }
          ]
        ]
      },
      "Merge - Message": {
        "main": [
          [
            {
              "node": "Prepara mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepara mensagem": {
        "main": [
          [
            {
              "node": "Insere a mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insere a mensagem": {
        "main": [
          [
            {
              "node": "Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca as mensagens": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Loop Over Items": {
        "main": [
          [
            {
              "node": "Concatena todas mensagens",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Define process_date",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Concatena todas mensagens": {
        "main": [
          [
            {
              "node": "Busca mensagem de ativação",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Define process_date": {
        "main": [
          [
            {
              "node": "Marca para processar",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Marca para processar": {
        "main": [
          [
            {
              "node": "Loop Over Items",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Se cancelado": {
        "main": [
          [
            {
              "node": "Cancel Run",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Para cada ação necessária": {
        "main": [
          [
            {
              "node": "Junta Resultados",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Separa Arguments",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Junta Resultados": {
        "main": [
          [
            {
              "node": "Prepara Resultado",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepara Resultado": {
        "main": [
          [
            {
              "node": "Insere Output",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Espera rodar um pouco": {
        "main": [
          [
            {
              "node": "Get Run Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Se Rate Limit": {
        "main": [
          [],
          [
            {
              "node": "Reprocessa Mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Reprocessa Mensagem": {
        "main": [
          [
            {
              "node": "Criar a Mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Busca mensagem de ativação": {
        "main": [
          [
            {
              "node": "Criar a Mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Lista Runs": {
        "main": [
          [
            {
              "node": "Se cancelado",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Criar Thread",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Cancel Run": {
        "main": [
          [
            {
              "node": "Criar a Mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pega Resposta Open AI": {
        "main": [
          [
            {
              "node": "Formata",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Insere Output": {
        "main": [
          [
            {
              "node": "Get Run Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Criar Thread": {
        "main": [
          [
            {
              "node": "Prepara atualização",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "É chat?": {
        "main": [
          [
            {
              "node": "Resposta chat1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Aggregate": {
        "main": [
          [
            {
              "node": "Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tipo de Mensagem": {
        "main": [
          [],
          [
            {
              "node": "Set Message from Text",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "enviar ultima resposta?": {
        "main": [
          [
            {
              "node": "Pega Resposta Open AI1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Tipo de Mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Pega Resposta Open AI1": {
        "main": [
          [
            {
              "node": "Formata1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Formata1": {
        "main": [
          [
            {
              "node": "Fala da mensagem de ativação?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Fala da mensagem de ativação?": {
        "main": [
          [
            {
              "node": "Encaminha Atendimento",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Responde última mensagem",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Encaminha Atendimento": {
        "main": [
          [
            {
              "node": "Discord",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Variáveis Globais": {
        "main": [
          [
            {
              "node": "Variáveis Globais - Code",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "É pra encerrar?": {
        "main": [
          [
            {
              "node": "Respond to Webhook",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Está em manutenção?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Basic LLM Chain": {
        "main": [
          [
            {
              "node": "É pra encerrar?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "OpenAI Model": {
        "ai_languageModel": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "ai_languageModel",
              "index": 0
            }
          ]
        ]
      },
      "Juntar Mensagens2": {
        "main": [
          [
            {
              "node": "Basic LLM Chain",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcreve Imagens": {
        "main": [
          [
            {
              "node": "Juntar Mensagens2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tem Imagem?": {
        "main": [
          [
            {
              "node": "Transcreve Imagens",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Juntar Mensagens2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Juntar Mensagens1": {
        "main": [
          [
            {
              "node": "Tem Imagem?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcreve PDFs": {
        "main": [
          [
            {
              "node": "Juntar Mensagens1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tem Arquivo?": {
        "main": [
          [
            {
              "node": "Transcreve PDFs",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Juntar Mensagens1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Juntar Mensagens": {
        "main": [
          [
            {
              "node": "Tem Arquivo?",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Transcreve Áudios": {
        "main": [
          [
            {
              "node": "Juntar Mensagens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Tem áudio?": {
        "main": [
          [
            {
              "node": "Transcreve Áudios",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Juntar Mensagens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Execute Workflow Trigger": {
        "main": [
          [
            {
              "node": "Se for chamada de função",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait": {
        "main": [
          [
            {
              "node": "Busca as mensagens",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "É chat?3": {
        "main": [
          [
            {
              "node": "Resposta chat",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Respond to Webhook1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Criar a Mensagem": {
        "main": [
          [
            {
              "node": "Run Assistant",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Lista Runs",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Run Status": {
        "main": [
          [
            {
              "node": "Switch Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Run Assistant": {
        "main": [
          [
            {
              "node": "Get Run Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Switch Status": {
        "main": [
          [
            {
              "node": "Espera rodar um pouco",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Espera rodar um pouco",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Se Rate Limit",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Pega Resposta Open AI",
              "type": "main",
              "index": 0
            }
          ],
          [],
          [
            {
              "node": "Captura Tool Calls",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Escolhe a tool que deve ser utilizada": {
        "main": [
          [
            {
              "node": "function_consultas",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "function_equipamentos",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "function_financeiro",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "function_pagamentos",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "consulta_bloqueantes",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "consulta_cobranca",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "consulta_futuros",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "consulta_pagos",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "gerar_pagamento",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "liberacao_confianca",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "perguntar_salvador",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "perguntar_salvador": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "liberacao_confianca": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "gerar_pagamento": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "consulta_pagos": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "consulta_futuros": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "consulta_cobranca": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "consulta_bloqueantes": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "function_pagamentos": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "function_financeiro": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "function_equipamentos": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "function_consultas": {
        "main": [
          [
            {
              "node": "Aggregate",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Chat Trigger": {
        "main": [
          [
            {
              "node": "Convert to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook Zap": {
        "main": [
          [
            {
              "node": "Variáveis Globais",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Se for chamada de função": {
        "main": [
          [
            {
              "node": "Convert to Webhook",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert to Webhook": {
        "main": [
          [
            {
              "node": "Variáveis Globais",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Argumentos + Id": {
        "main": [
          [
            {
              "node": "Escolhe a tool que deve ser utilizada",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "settings": {
      "executionOrder": "v1"
    },
    "staticData": null,
    "meta": {
      "templateCredsSetupCompleted": true
    },
    "pinData": {},
    "versionId": "69a1945e-5219-4e45-80d8-cd46cefb3e69",
    "triggerCount": 0,
    "tags": [
      {
        "createdAt": "2024-10-01T12:52:45.165Z",
        "updatedAt": "2024-10-01T12:52:45.165Z",
        "id": "sHPTg31YIGveJtZK",
        "name": "Esperanza V2"
      }
    ]
  }
}